# 개발일지

## 2026-01-19 (Day 1)

### 완료 사항

**1. MinerU 설치 및 테스트**
- MinerU v2.7.1 설치 완료
- Mac MPS 설정 (`~/.mineru/config.json`)
- test.pdf 파싱 성공 (Body: 71 paragraphs, Tables: 1, Equations: 3)

**2. AI Agent 워크플로우 구축**
- Claude Code: 계획/프롬프팅 전용 (코드 수정 금지)
- Codex: 코드 구현/실행 담당
- `CODEX_PROMPT.md` → `codex-result.md` 워크플로우 확립

**3. 핵심 모듈 구현**
- `src/parser/mineru_parser.py`: MinerU CLI 래퍼
- `src/parser/paragraph_builder.py`: 블록 → 개별 Paragraph 변환
- `src/translator/openai_translator.py`: OpenAI API 번역 (gpt-4o-mini)
- `src/cli.py`: CLI 파이프라인

**4. 번역 속도 최적화**
- 배치 번역 구현 (25개 문단씩)
- AsyncOpenAI 병렬 처리 (semaphore=3)
- 배치 실패 시 개별 비동기 번역 fallback 추가

**5. Gradio 프론트엔드**
- 좌우 분할 레이아웃 (PDF | 번역본)
- PDF 이미지 렌더링 (PyMuPDF)

**6. 하이라이트 동기화 구현** ✅
- bbox 좌표 계산 수정 (정규화×1000 형식 처리)
- SVG viewBox로 이미지 축소와 동기화
- Gradio JavaScript 실행 문제 해결 (`gr.Blocks(js=...)`)
- **양방향 하이라이트 완성**:
  - 번역본 hover → PDF 하이라이트
  - PDF hover → 번역본 하이라이트

### 알려진 이슈
- MinerU MPS/CPU 크래시 → 기존 output 재사용으로 우회
- **문장 단위 하이라이트 불가**: MinerU가 블록(문단) 단위 bbox만 제공

### 다음 작업
- [ ] 빠진 paragraph 해결 
- [ ] 하이라이트 반대로 (pdf -> 번역)
- [ ] UI/UX 개선
- [ ] 문장 단위 하이라이트 (OCR 기반 솔루션 검토)
